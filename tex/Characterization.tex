
\red{rifai il conto della lunghezza di attenuazione. Ho trovato (presentazione Luciano Mus) 29 um per ka e 37 um per kb. }

\section{TJ-Monopix1 characterization}
    %\subsection{}
    %Di che con l'hv a parte quando usiamo i valori del FE: riportali, non abbiamo una configurazione stabile e si accendono tanti pixel. 
    
    %Con il PMOS la configurazione del FE di default è: e richiama i significati delle variabili. 
    %threshold scan per sapere il punti di lavoro ok. 
    %soglia dell'automasking a 10 Hz. 

    \subsection{Threshold and noise: figure of merit for pixel detectors}
        %python3 -i calibration/scurve_tot_histo.py -f calibration/calibration_data/20220506 -i 1 100 questo script crea i file di output contenenti i gli istogrammi del tot e della s curve
        %python3 -i calibration/tot_charge_plotting.py -f calibration/calibration_data/20220506 per fare il plot della s curve e relativi residui 
        %python3 -i calibration/tot_histo2d.py -f calibration/calibration_data/PMOS/20220506 per fare l'istogramma 2d del tot
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.6\linewidth]{figures/charaterization/scurve.pdf}
            \caption{S-curve for pixel (10, 10) of the PMOS flavor (flavor 1) with IDB fixed at \SI{40}{DAC}. The conversion of charge injected from DAC to electrons has been done assuming a conversion factor of \SI{20}{e-/DAC}. }
            \label{fig:scurve}
        \end{figure}   

        \begin{figure}[h!]
            \centering
            \includegraphics[width=.49\linewidth]{figures/charaterization/threshold_histogram.png}
            \includegraphics[width=.49\linewidth]{figures/charaterization/noise_histogram.png}\\
            \includegraphics[width=.49\linewidth]{figures/charaterization/threshold_map.pdf}
            \includegraphics[width=.49\linewidth]{figures/charaterization/noise_map.pdf}            
            \label{fig:threshold_noise_hist}
            \caption{Histograms of the threshold (a) and the noise (b) found fitting the s-curve of \red{all} flavor with IDB fixed at \SI{40}{DAC}.Maps of the threshold (a) and the noise (b) found fitting the s-curve with IDB fixed at \SI{40}{DAC}. The white pixels have the injection circuit broken. }
        \end{figure}            
           
        A characterization of threshold and noise is typically necessary since these values have an impact on the operating conditions and on the performance of the chips. 
        infact, the signal to threshold ratio may be considered as the figure of merit for pixel detectors rather than the signal to noise ratio.
        The mean minimum stable threshold evolved through different generation of chips: in the 1st generation it was around \SI{2500}{e-} while in the 3rd (corresponding to nowadays chips) is less than \SI{500}{e-}. This allows in thinner sensors with smaller signals: from \SI{16000}{e-} produced in \SI{200}{\um}, the signal expected moved down to \SI{2000}{e-} produced in \SI{25}{\um}. According with this \red{??}, the threshold of TJ-Monopix1 is around \SI{500}{e-}.
        The following prototypes have lower threshold and noise, for example TJ-Monopix2 has \red{check}, according to the above.
        The threshold has to be located between the noise peak around the baseline and the signal distribution, in particular it has to be low enough to mantain a high signal efficiency, but also high enough to cut the noise: for a low threshold many pixels can fire at the same time and a positive feedback can set off a chain reaction eventually, causing all the other pixels to fire.
        \red{Thus, the noise sets a lower bound to the threshold: if an occupancy $\leqslant$ $10^{-4}$ is required, for example, this correspond to the Gaussian 1-sided tail fraction for \SI{3.7}{\sigma}.
        In this case, if the noise is \SI{100}{e-}, for example, the threshold must be higher than \SI[parse-numbers=false]{3.7\times100}{e-}.}
        Typically this argument sets only a minimal bound to the threshold since the variation with time and from pixel to pixel have to be taken into account: the temperature, the anealing (for example, the radiation damages in the oxide layer causes shift of MOSFET threshold voltage) and the process parameters variation across the wafer (as for example process mismatch between transistors). 
        
        On the other hand the noise is valued at the preamplifier input node given that the first stage of amplification is the most crucial since the signal amplitude is high compared to additional noise introduced by the following stages.
        The noise is then parameterized as Equivalent Noise Charge (ENC), which is defined as the ratio between the noise N at the output expressed in Volt and the out voltage signal S produced by \SI{1}{e-} entering in the preamplifier:
        \begin{equation}
            ENC\, =\, \frac{N_{out}[V]}{S_{out}[V/e-]}\,=\,\frac{V^{RMS} _{noise}}{G}
        \end{equation} 
        with G expressed in \si{V/e-}; as the gain increases, the noise reduces . 

        \red{ENC is mainly influenced by the total input capacitance and by the system bandwidth: if the bandwidth is constant, noise can be reduced by increasing the input transistor transconductance (and consequently power consumption).}
        Considering the threshold dispersion a requirement for the ENC is: 
        \begin{equation}
            ENC < \sqrt{(T/3.7)^2 - T_{RMS} ^2 (x) - T_{RMS} ^2 (t)}
        \end{equation}
        where the T is the threshold set, $T_{RMS}$ is the threshold variation during time (t) and across the matrix (x); a typical reasonable value often chosen is \SI{5}{ENC}.

        Because of the changing of the 'real' threshold, the possibility of changing and adapting the setting parameters of the FE, both in time and in space is desiderable: these parameters are usually set by Digital to Analog Converter (DAC) with a number of bit in a typical range of 3-7.
        Unfortunately DAC elements require a lot of space that may be not enough on the pixel area; therefore, the FE parameters are typically global, which means that they are assigned for the whole chip, or they can be assigned for regions the matrix is divided into. 
        The former case corresponds to TJ-Monopix1's design in which 7 bits are used for a total 127-DAC possible values, while the latter corresponds to the ARCADIA-MD1's one, \red{where quanti bit??}. 
        An other possibility, for example implemented in TJ-Monopix2, is allocate the space on each pixel for a subset of bits, then combinig the global threshold with a fine tuning. 
        If so, the threshold dispersion after tuning is expected to be inversely proportional to the tuning DAC number of bits and thus be improved a lot:
        \begin{equation}
            \sigma_{THR, tuned} = \frac{\sigma_{THR}}{2^{n bit}}
        \end{equation}    
        where $\sigma_{thr}$ is the RMS of the threshold spread before tuning.

        To measure the threshold and noise of pixels a possible way is to make a scan with different known injected charge: the threshold corresponds to the value where the efficiency of the signal exceeds the 50\%, and the ENC is determined from the width of this edge.        
        Following this path, I have used the injection circuit available on the chip to inject 100 pulses for each input charge for a fixed threshold.
        The injection comes on a capacity at the input of the FE circuit, whose mean value is \SI{230}{aF} and from which the conversion factor from DAC units to electrons can be obtained: for the PMOS flavor, for example, since the DAC are biased at \SI{1.8}{V}, the Least significant Bit (LSB) corresponds to a voltage of \SI{14.7}{mV} from which the charge for LSB \SI{1.43}{e-/mV} and the conversion factor therefore is \SI{20.3}{e-/DAC}.     
        While this value is equivalent for all the PMOS flavor, the HV flavor is expected to have a different conversion factor, $\sim$ \SI{33}{e-/DAC}, beacuse of the different input capacity. 

        Besides the charge, also the duration and the period of the injection pulse can be set; it is important to make the duration short enough to have the falling edge during thed dead time of the pixel (in particular during the FREEZE signal) in order to avoid the undershoot, coming at high input charge, triggering the readout and reading spurious hits. 
        Since the injection circuit is coupled in AC to the FE, if the falling edge of the pulse is sharp enought to produce ad undershoot, this can be seen as a signal. 

        Assuming a gaussian noise, the efficiency of detecting the signal can be described through a modification of the error function:
        \begin{equation}
            f(x, \mu, \sigma) = \frac{1}{2} \; \left(1\,+\,erf\left(\frac{x-\mu}{\sigma \sqrt{2}}\right)\right)
            \label{eq:fit_scurve}
        \end{equation}
        with: 
        %\begin{equation} 
        %    erf(z) = \[ \int_{0}^{z} \frac{2}{\sqrt{\pi}} e^{-x^2} dx  \]
        %\end{equation} 
        where the threshold and the ENC corresponds to the $\mu$ and $\sigma$.
        Therefore I perform a fit of the counts detected using the function in equation \ref{eq:fit_scurve}. In figure \ref{fig:scurve} there is an example with IDB (look at table \ref{tab:} for the meaning of the parameter) equal to \SI{40}{DAC} of fit for a pixel belonging to the flavor 1, while in table \ref{tab:} and figure \ref{fig:threshold_noise_hist} and \ref{fig:threshold_noise_map} there are the histograms and the maps of the parameters of the scurve-fit. 

        \begin{table}
                \begin{center}
                \begin{tabular}{| c | c | c |}
                \hline
                 & DAC units & electrons \\
                \hline
                \hline
                Threshold        & 24.529 $\pm$ 0.049 & \\
                                 &u: 24.433 $\pm$ 0.049 & \\ 
                                 &d: 24.623 $\pm$ 0.051 &    \\      
                Threshold dispersion & 1.848 $\pm$ 0.033 &\\
                                 &u: 1.867 $\pm$ 0.034 & \\ 
                                 &d: 1.825 $\pm$ 0.035 &    \\ 
                Noise            & 0.8222 $\pm$ 0.0043 & \\
                                 &u: 0.8225 $\pm$ 0.0045 & \\ 
                                 &d: 0.8221 $\pm$ 0.0043 &    \\      
                Noise dispersion & 0.0975 $\pm$ 0.0030 &\\
                                 &u: 0.0968 $\pm$ 0.0031 & \\ 
                                 &d: 0.0970 $\pm$ 0.0030 &    \\ 
                \hline
                \end{tabular}
                \caption{Flavor PMOS, IDB fixed at \SI{40}{DAC}}
                \label{tab:}
                \end{center}
        \end{table}        
    
        To verified the trend of the threshold as a function of the front end parameter IDB, I have permormed a scan with different IDBs: I have injected the whole matrix and found the means and the standard deviation of the distributions. The results are shown in figure \ref{fig:threshold_vs_IDB}.
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.70\linewidth]{figures/charaterization/thr_vs_IDB.pdf}
            \caption{}
            \label{fig:threshold_vs_IDB}
        \end{figure}            
   

    \subsection{Linearity of the ToT}    
        %python3 -i acquisition_Fe55/fit_tot_single_pixel.py -f acquisition_Fe55/source_PMOSS/ per fare il fit    
        %python3 -i acquisition_Fe55/plot_tot_single_pixel.py -f acquisition_Fe55/source_PMOSS/ -fl 'gauss_line' per fare il plot di single pixel
        I have already said in chapter \ref{chap:Monopix1} that TJ-Monopix1 returns an output signal proportional to the charge released by a particle in the epitaxial layer, which is the Time over Threshold; the ToT is saved as a 6-bit variable and then has a dynamic range equal to 0-64, which corresponds to \SIrange{0}{1.6}{\us} assuming a clock frequency of \SI{40}{MHz}.
        When a pulse is longer than \SI{1.6}{\us} the counter rolls back to zero and there is no way to distinguish that charge from a lower one with the same ToT: that is the rollover of the ToT (\ref{fig:ToT_vs_charge}(a)).   

        In order to associate the ToT (in range 0-64) to the charge, a calibration of the signal is necessary. Assuming the linearity between ToT and the charge, Q can be found: 
        \begin{equation}
            Q\, [DAC] = \frac{(ToT\,[au]\, -\, q\,[au])}{m\, [au/DAC]} 
        \end{equation}
        where m and q are the fitted parameters of the calibration.
        It is important to keep in mind that the main application target of TJ-Monopix1 is in the inner tracker detector of HEP experiments, then the main feature is the efficiency, then a rough calibration of the signal to charge is fine; \red{this information can be used to improve??}. 
        
        The study of the output signal is made possibile via the injection: since the pulses are triangular, the ToT is expected to be almost linear depending on the injection charge value.
        To verify this statement and study the deviations from linearity I've fit the ToT versus the charge injected for all pixel within the matrix.
        In figure \ref{fig:ToT_vs_charge}(b) there is an example of fit for a pixel belonging to the flavor 1, while in figure \ref{fig:ToT_histograms_all_fl} and \ref{fig:ToT_fit_param_map} there are the histograms and the maps of the parameters of the line-fit for all flavors with IDB fixed at \SI{40}{DAC}.   

        Before performing the fit I have calculated the mean value of the ToT of the pulses recorded for each pulse amplitude and I used the mean ToT as value for the fit. 
        The aim of the calibration obviously is finding a relation only in the range 0-64 without taking into account the rolling over hits: therefore, to prevent the rollover data from reducing the mean ToT introducing a bias in the mean value, I cut and I did not consider them. 
        If a signal bigger than the \SI{1.6}{\us} is expected in the usage of the detector, the threshold must be raised or the gain reduced, making the expected output signal in range 0-64. 
        In figure \ref{fig:ToT_vs_charge} (b) are shown both the fits with a line (red) and with a second order polynomial (green): at the bounds of the ToT range values deviate from the line model. Since the deviation is low than \red{controlla quant'era, questo ha un impatto sul valore della calibrazione di tipo .. che è trascurabile al primo ordine. e comunque hai problemi ai bounds mentre al centro hai comunque una buona linearità.}. 
        \red{Chiarire la differenze negli istogrammi e come mai ci sono delle bande nelle mappe.}

        \begin{figure}[h!]
            \centering
            \includegraphics[width=.49\linewidth]{figures/charaterization/ToT_rollover.png}            
            \includegraphics[width=.49\linewidth]{figures/charaterization/ToT_injection.pdf}
            \label{fig:ToT_vs_charge}
            \caption{The figures refer to pixel (10,10) of the PMOS-reset flavor (1) with IDB fixed at \SI{40}{DAC}. (a) Histogram of the injection pulses: the ToT is in range 0-64 since it is represented by 6 bit, so when achieving the 64 it rolls over back to the zero. (b) Mean ToT vs the the charge: the mean has been calculated cutted the rolling hits. }
        \end{figure}    

        \begin{figure}[h!]
            \centering
            \includegraphics[width=.49\linewidth]{figures/charaterization/slope_histogram.png}
            \includegraphics[width=.49\linewidth]{figures/charaterization/intercept_histogram.png}\\
            \includegraphics[width=.49\linewidth]{figures/charaterization/slope_map.pdf}
            \includegraphics[width=.49\linewidth]{figures/charaterization/offset_map.pdf}
            \caption{Histograms of the calibration parameters, slope (a) and offset (b), found fitting the ToT with a line, for \red{all} flavor and with IDB fixed at \SI{40}{DAC}. Maps of the calibration parameters, slope (a) and offset (b), found fitting the ToT with a line, with IDB fixed at \SI{40}{DAC}}
            \label{fig:ToT_histograms_all_fl}
        \end{figure} 

        \red{perchè noise e th sono diverse per diversi flavor? Controlla cos' hanno di diverso.}
        \begin{table}
            \begin{center}
            \begin{tabular}{| c |  c | c | c |c |}
            \hline
            & PMOS 0 & PMOS 1 & PMOS 2 & HV \\
            \hline
            \hline
            Slope [au/DAC] & 0 .75566 $\pm$ 0.00149 & 0.57145 $\pm$ 0.00025 \\
            Slope dispersion [au/DAC] & 0.03841 $\pm$ 0.00037 & 0.01685 $\pm$ 0.00016\\
            Intercept [au] & -11.6070 $\pm$ 0.0089 & -10.824 $\pm$ 0.019 \\
            Intercept dispersion [au] & 1.5176 $\pm$ 0.0063 & 1.225 $\pm$ 0.013\\
            \hline
            \end{tabular}
            \caption{Mean calibration parameters for \red{all} flavor and their dispersion on the matrix. }
            \label{tab:calibration_param}
            \end{center}
        \end{table}        

    \subsection{Calibration of the ToT}
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.49\linewidth]{figures/charaterization/fit_gauss_r69.pdf}
            \includegraphics[width=.49\linewidth]{figures/charaterization/fit_line_gauss_r69.pdf}\\
            \includegraphics[width=.49\linewidth]{figures/charaterization/fit_gauss_r185.pdf}
            \includegraphics[width=.49\linewidth]{figures/charaterization/fit_line_gauss_r185.pdf}
            \caption{due pixel per far vedere la differenza tra i fit. Sottolinea che in rosso ci sono i bin fittati. La doppia scala utilizza le info trovate nel paragrafo precedente per il dato pixel in questione. Per avere una corrispondenza grezza in elettroni basta moltiplicare per 20 e- dac. }
        \end{figure}  
        %python3 -i acquisition_Fe55/fit_tot_single_pixel.py -f acquisition_Fe55/source_PMOSS/Fe_acquisitions_6V/ per fare i fit. Attenzione che prende i file degli istogrammi npz già
        Considering that the charge injected in the FE goes to fill capacitor which is different from pixel to pixel, the true charge injected does not correspond to what expected assuming C equal to \SI{230}{aF}, the nominal value. 
        Accordingly to that, a verification of the value provided and an absolute calibration of this capacity and of the conversion factor F is needed to have a correspondence of the signal in electrons; assuming C \SI{230}{aF}, F is expected to be \SI{20}{e-/DAC}, and is defined as:
        \begin{equation}
            F\, [e-/DAC] = \frac{1616\,e-}{Q\,[DAC]}
        \end{equation}

        For this pourpose a Fe55 radioactive source has been employed; the Fe55 is en extremely important radionuclide in the calibration of X-ray spectrometers, proportional counter and scintillator detector since it emits two two X-photons during the electron capture decay: the first one (K$_\alpha$) at \SI{5.9}{keV} and the second one (K$_\beta$) at \SI{6.5}{keV}.
        The K$_\alpha$ photon, which does photoelectric effect in the silicum, has an absorption length $\lambda$=\SIrange{7}{8}{\um}, and the probability of being assorbed in the \SI{25}{\um} thick epitaxyal layer is $\sim$0.95\.
        The electron emitted has an energy equal to the photon one, so recalling that the mean energy needed to produce a couple electron-vacuum is \SI{3.65}{eV}, the signal produced by the Fe55 source is expected to be \SI{1616}{e-}.
        In figures \ref{fig:fit_r185} and \ref{fig:fit_r69} are shown two histograms of the ToT spectrum of the Fe55 source for two different pixels. The peak corresponds to the events with completely absorption of the charge produced in the depleted region, while the long tail on the left to all the events with partial absorption due to charge sharing among neighbors pixels. In order to reduce the charge sharing, the pixel dimension in TJ-Monopix2 has been reduced down to \red{check}. 
        The events on the right side of the peak, instead, corresponds to the K$_{\beta}$ photons. 
        Looking at the histograms for pixel (30, 185) and (30,69) a significant difference in the peak to tail ratio leaps out. 
        This difference in the efficiency of detecting the signal can be related with the position of the pixel in the matrix: in particular pixels in the upper part of the matrix (rows 112-224) have a more prominent peak, while in pixels in the lower part (rows 0-111) there is a higher partial absorption. 
        I recall now that there is a slighly difference in the structure of the low dose-epi layer (\ref{chap:}) among the rows in the matrix, in particular pixels in rows 112-224 are supposed to have a higher efficiency in the pixel corner. 
        
        For the calibration I have need to establish the peak position; to do that I perform a fit of the ToT histogram of each pixels. As fit functions I test both the solutions below:  
        \begin{equation}
            f(x, N, \mu, \sigma) = \frac{N}{\sigma \sqrt{2\pi}} e^{-\frac{1}{2}(\frac{(x-\mu)}{\sigma})^2}
            \label{eq:gauss}
        \end{equation} 

        \begin{equation}
            f(x, m, q, N, \mu, \sigma) = m\,x + q + \frac{N}{\sigma \sqrt{2\pi}} e^{-\frac{1}{2}(\frac{(x-\mu)}{\sigma})^2}
            \label{eq:gauss_line}
        \end{equation}          
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.49\linewidth]{figures/charaterization/deltam_Fe.pdf}
            \includegraphics[width=.49\linewidth]{figures/charaterization/deltas_Fe.pdf}
            \caption{Here there are shown the defference between the parameters $\mu$ and $\sigma$ fitted with only a gaussian and with a gaussia plus a line. When $\mu<$0 the fit function \ref{eq:gauss} has given a worst peak (shifted on the left); when $\sigma<0$, \ref{eq:gauss_line} has given a worst peak width (larger sigma)}
            \label{fig:delta_fit}
        \end{figure}           
        \red{Nel primo caso ho fittato pochi pixel attorno a picco: il range è stato determinato .. controlla. 
        Nel secondo caso invece il range è..  Controlla sullo script  }  
        Even if the difference in the peak position between the two cases is not really relevant (\ref{fig:delta_fit}) being of the order of 0.8-1.5 \%,  it still introduces a systematic effect moving the peak on the left beacuse of the contribution of the tail. 
        Indeed, we know that the sharp edge on the right corresponds to the complete absorption of the photon, so excluding the little bump on the right, the more the fitted parameter is on the right, the better the fit is. Moreover, there is also systematic effect on the peak width, infact the worst fit also gives an overestimation of the peak width.  
        Even looking at the $\chi^2$, the fit function \ref{eq:gauss} seems so be the better choise, except for a sample of pixels on the lower part of the matrix, the one with lower efficiency.

        \red{Mappa del ferro da cui, come descritto enll'equazione si ricava la capacity.        
        La struttura a bande della capacità ha origine nel plot... e quindi nella calibrazione. 
        Andando a vedere gli istogrammi di queste due variabili si vedono dei picchi. C'è qualche struttura nella matrice che condiziona il funzionamento delle righe?
        Larghezza della gaussiana: fai il discorso a cosa contribuisce ad un picco così largo. è compatibile con quanto ti aspetti?}
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.49\linewidth]{figures/charaterization/conversion_factor_map.pdf}
            \includegraphics[width=.49\linewidth]{figures/charaterization/Fe_width_DAC_hist.pdf}            
            \label{fig:}
            \caption{}
        \end{figure}         



    \subsection{PMOS flavor: changing the bias}\label{chap:characterization_section:bias}
    In order to study the behavior of the sensor changing the bias, I perform some injection scans in different configurations. 
    The thickness of the depletion has to be considered indeed an important parameters for the efficiency of the signal, and in particular it plays an important role if \red{bho, trova qualcosa da dire}.

    Given that the chip under examination has a gap in the low dose epi-layer (look at chapter \ref{chap:}) we were not able to change independently the bias of the substrate (PSUB) and of the p-well (PWELL), but they must be kept at the same value, differently from other chips, where thay can be changed as reported in figure \ref{fig:gain_vs_bias}.
    Turning down the bias, the depletion region narrows and the efficiency reduces in particular in the pixel corner; 
    \red{La soglia si alza di meno di 1/3, mi sarei aspettata un po' di più guardando il plot. Attenzione che il plot non è fatto con un ngap, quindi ci sta che il guadagno lì cali più bruscamente. poi non si capisce benissimo dalla colormap.  Anche la slope diminuisce di circa meno di un terzo. Il noise aumenta leggermente. Il picco del ferro invece si sposta a siniSTRA di un terzo. Lo spostamento è dovuto alla diminuzione del gain, che influisce sul ToT.}

    \begin{table}
            \begin{center}
            \begin{tabular}{| c |  c | c | c |}
            \hline
               & -\SI{6}{V} & -\SI{3}{V} & \SI{0}{V}\\
            \hline
            \hline
            Threshold [DAC] & 20.04 $\pm$ 1.6 & 21.0 $\pm$ 1.6 & 24.5 $\pm$ 1.8\\
            Noise [DAC] & 0.613 $\pm$ 0.075 & 0.625 $\pm$ 0.078 & 0.822 $\pm$ 0.098\\
            Slope [au/DAC] & 0.726 $\pm$ 0.027 & 0.707 $\pm$ 0.028  & 0.573 $\pm$ 0.021\\
            Offset [au] & -10.8 $\pm$ 1.9 & -11.2 $\pm$ 1.8 & -11.1 $\pm$ 1.5 \\
            \hline
            \end{tabular}
            \caption{The errors are the standard deviations of the corresponding distributions.}
            \label{tab:parameters_vs_bias}
            \end{center}
        \end{table}  

        
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.60\linewidth]{figures/charaterization/Fe_spectrum_bias.pdf}
            \caption{With the same acquisition time. }
            \label{fig:Fe_spectrum_bias}
        \end{figure}            
   
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.70\linewidth]{figures/charaterization/Fe_param_vs_bias.pdf}
            \caption{\red{da rifare tenendo la sorgente ferma tra un'acquisizione e l'altra}}
            \label{fig:Fe_param_vs_bias}
        \end{figure}     


    \subsection{Measurements with radioactive sources}
        %python3 -i acquisition_Fe55/find_cluster.py -d acquisition_Fe55/source_PMOSS/noise_acquisitions_6V -> per cluster dimension e spettro del noise
        %python3 -i acquisition_Fe55/hit_map.py -f acquisition_Fe55/source_PMOSS/2022-04-07/2022-04-07_10-10-01_acq.h5 -> per le hit map, comprese qualche hitmap dei cluster
        %python3 -i acquisition_Fe55/Sr90_spectrum.py -d acquisition_Fe55/source_PMOSS/noise_acquisitions_6V/ -> per fare i plot dello stronzio
        Signal response characterization using radioactive sources and cosmic rays have been made. 
        The Sr90 source emits electrons that: lo spettro ha un cutoff a che E?  

        \red{conto/plot sulla differenza elettrone sr e mip}.
        The signal generated by electrons is similar to the one generated by minimum ionizing particle (MIPS).
        The spectrum is expected to follow a Langau-Gauss distribution

        \begin{itemize}
            \item sommato i cluster Spiega la tua definizione di cluster.
            \item plot dello spettro del ferro convertendo in elettroni per il PMOS flavor e facendo la somma dei cluster. 
            \item di che la tua definizione di cluster è ok perchè sono quasi tutti vicini: plot con la distanza e qualche stima delle coincidenze casuali.
            \item mappa di qualche evento di cluster sia per Sr che per FE
            \item istogrammi in carica, con carica sommata di Sr e Fe, oer il flavor PMOS dove hai fatto la calibrazione o per tutti?
        \end{itemize}

        Spiega che con il flavor HV abbiamo una perdita di sengnale, fai vedere uno spettro di delle misure dell 8 marzo. 

       
   
         
    \subsection{Dead time measurements}
        The hit loss is due to analog and digital pile up: the first one occurs when a new hit arrives during the pre-amplifier response, the second instead, which is the more relevant contribution with high rate, while the information of the previous hit has not yet been transferred to the periphery.  
        As only one hit at a time can be stored on the pixel's RAM, until the data have completed the path to get out, the pixel is paralyzed and the dead time $\tau$ almost corresponds with the time needed to trasmit the data-packets off-chip.
        Since the exportation of data from pixel to the EoC occurs via a 21-bits data bus, only one clock cycle is need to transfer the data to the end of column and the dead time bottleneck is given by the bandwidth of the serializer at the EoC. In our setup the serializer operates at 40 MHz, thus to transmit a data packet (27-bit considering the addition at the EoC) at least \SI{675}{ns} are needed. 
        For what we have said so far, the R/O is completely sequential and therefore is expected a linear dependence of the reading time on the number of pixels to read:
        \begin{equation}
            \tau =\, 25\: \unit{ns}\, \times\, (\alpha\, N +\, \beta)
            \label{eq:reading_time}
        \end{equation}
        where $\alpha$ and $\beta$ are parameters dependent on the readout chain setting. 
        
        To measure and test the linearity of the reading time with the number of pixels firing, I have used the injection mode available on the chip. 
        Indeed, the injection mode allows fixing not only the amplitude of the pulse, which corresponds to the charge in DAC units, but also the period and the width.
        I have injected a fix number of pulses (100) and looked for the rate when the efficiency decreases. 
        Moreover to test that there is no dependece of the digital readout time from the charge of the pulse, I have try to change the amplitude of the pulse injected, but the parameters found were consistent with the default configuration ones.

        \red{Al posto degli esempi con 5 e 10 pixels metterei un esempio dell'efficienza vs il periodo quando leggo un singolo pixel. Una cosa che volevo fare era anche provare a fittare la slope con cui l'efficienza scende: se la slope è uguale per tutti il readout diventa completamente predittivo. }
        \begin{figure}[h!]
            \begin{subfigure}{.5\textwidth}
            \centering
            \includegraphics[width=.98\linewidth]{figures/charaterization/efficiency_5pixels.png}
            \caption{\red{efficiency vs DELAY 5 pixels}}
            \label{fig:}
            \end{subfigure}
            \begin{subfigure}{.5\textwidth}
            \centering
            \includegraphics[width=.98\linewidth]{figures/charaterization/efficiency_10pixels.png}
            \caption{\red{efficiency vs DELAY per 10pixels}}
            \label{fig:}
            \end{subfigure}
        \end{figure}
        
        While the single pixel reading time and the dead time do not depend on the position on the pixel matrix and are equal to \red{106 (46+60)} clock counts within 1 clock count, on the other hand the $\tau$ depends on the pixel position on the matrix when more than one pixel are firing. 
        In particular the priority chain goes from row 224 to row 0, and from col 0 to 112, that means the last pixels to be read is the one on le bottom right corner of the matrix. 

        In figure \ref{fig:dead_time} is reported the reading time versus the number of pixels injected; the R/O parameters that control the reading time and their default values are reported on table \ref{tab:tab:R/O_param}.
        \begin{table}
            \begin{center}
            \begin{tabular}{|c | c | c |}
            \hline
            Parameter & Value [\si{DAC}] & Value [\si{\us}]\\
            \hline
            \hline
            START\_FREEZE & 64 & 1.6\\
            STOP\_FREEZE & 100 & 2.5\\
            START\_READ & 66 & 1.65\\
            STOP\_READ & 68 & 1.7\\
            \hline
            \end{tabular}
            \caption{Default configuation of the R/O parameters}
            \label{tab:R/O_param}
            \end{center}
        \end{table}

        The factor $\alpha$, referring to eq. \ref{eq:reading_time} is proportional to the difference (STOP\_FREEZE - START\_READ), while the offset $\beta$ lies between 5 and 15 clock counts.
        Since through the injection a random hit rate on the matrix can't be simulated, as the coordinates of the pixels to inject must be specified, for convenience I used the pixels on the same column/row. No difference in the $\alpha$ and $\beta$ coefficients has been observed between the two case. 
        \begin{figure}[h!]
            \centering
            \includegraphics[width=.9\linewidth]{figures/charaterization/default_line.png}
            \caption{}
            \label{fig:dead_time}
        \end{figure}

        \begin{figure}[h!]
            \centering
            \includegraphics[width=.9\linewidth]{figures/charaterization/parameters_points.png}
            \caption{}
            \label{fig:dead_time}
        \end{figure}        

        \red{Ci sarebbe da spiegare perchè i parametri che usiamo noi come default non sono quelli che minimizzano il tempo di lettura. La spiegazione è che "Abbiamo copiato i valori dal repositorio di quelli di Bonn". Un'altra domanda potrebbe essere: come mai non ho esplorato una zona più vasta per i parametri del R/O. Cambiando molto i parametri del R/O la lettura non funzionava per niente: ad esempio CONF\_STOP\_FREEZE non può essere impostato nè sopra 105 nè sotto 95}



\section{ARCADIA-MD1 characterization}
